- #freqtrade
- https://botacademy.ddns.net/2024/05/02/st-kasuari-btc/
- ## 策略分析
	- 好的，我们来用中文解读一下这份 Freqtrade 策略代码 (`Kasuari_btc_template`)。
	  
	  **核心思想和作者意图：**
	  
	  1.  **这是一个模板，不是成品策略：** 作者反复强调，这只是一个**基础模板**，**绝对不能直接用于实盘交易**。它是为你自己开发策略提供的一个起点。直接使用会亏钱。
	  2.  **核心概念：移动平均线偏移 (MA Offset)：** 策略的基本思路似乎是围绕“移动平均线偏移”构建的。这通常意味着计算一个移动平均线（如 HMA、DEMA、TEMA、EMA），然后通过加上或减去一个偏移量（通常是 MA 本身的一个百分比或基于 MA 计算的某个值）在其上下创建通道带。当价格触及或穿越这些偏移带时，可能会触发交易信号。
	  3.  **作者的声明：** 作者提到，*基于此模板开发出来的一个版本*在过去 6 个月表现良好，因此他决定发布这个*基础*结构。
	  4.  **需要自己动手开发：** 你需要自己投入工作来完善它，作者不提供付费版或完整版。
	  5.  **占位符逻辑：** 最关键的警告是代码中的某些部分，特别是像 `rsi_1`, `rsi_12` 这样的条件，**仅仅是占位符**，需要被替换成真实的、能工作的交易逻辑（例如，将 RSI 值与具体的阈值进行比较）。**按原样使用很可能导致策略无法运行或产生错误的交易信号。**
	  
	  **关键组件和特性：**
	  
	  1.  **框架：** 代码是为 Freqtrade（一个流行的开源加密货币量化交易机器人框架）编写的。
	  2.  **使用的技术指标：**
	      *   移动平均线 (Moving Averages): HMA (赫尔移动平均线), DEMA (双指数移动平均线), TEMA (三指数移动平均线), EMA (指数移动平均线)。代码包含了自定义函数 `tv_hma` 和 `tv_wma` 来模拟 TradingView 的计算方式。
	      *   震荡指标 (Oscillators): RSI (相对强弱指数), MFI (资金流量指数), STOCHF (快速随机指标)。
	      *   成交量 (Volume): 原始成交量以及标准化的滚动成交量指标 (`vol_base`, `vol_20` 等)。
	  3.  **参数 (Parameters)：**
	      *   广泛使用了 Freqtrade 的 `IntParameter`，允许通过 Freqtrade 的超参数优化功能来调整指标的各种周期长度（如 `buy_length_hma1`）和偏移量（如 `buy_offset_hma1`）。
	      *   许多参数初始设置为 `optimize = False`，意味着在默认的超参数优化运行时不会调整它们，除非你手动修改。
	      *   包含了 RSI 和 MFI 的阈值、滚动周期等参数。
	  4.  **策略配置 (Configuration)：**
	      *   `timeframe = '15m'`: 策略在 15 分钟 K 线上运行。
	      *   `can_short = True`: 设计上可以进行多头和空头交易。
	      *   `lev = 10`: 设置了固定的 10 倍杠杆。**这是高风险设置。**
	      *   `minimal_roi = {"0": 0.015}`: 设置了一个从入场点开始计算的止盈目标为 1.5% (0.0015 * 10倍杠杆)。这是一个非常小的目标，暗示可能是剥头皮（Scalping）类型的策略。
	      *   `stoploss = -0.99`: **极其危险的默认止损！** 99% 的止损几乎等于没有止损，尤其在 10 倍杠杆下。在任何实际应用中**必须修改**此值。
	      *   `trailing_stop = False`: 默认禁用追踪止损。
	      *   `use_exit_signal = True`: 依赖于 `populate_exit_trend` 中定义的具体出场信号，而不仅仅是止盈或止损。
	  5.  **入场逻辑 (`populate_entry_trend`)：**
	      *   使用配置的参数计算各种偏移移动平均线 (HMA, DEMA, TEMA)。例如 `dataframe['hma_offset_buy1'] = tv_hma(dataframe, int(5 * self.buy_length_hma1.value)) * 0.05 * self.buy_offset_hma1.value` 这行代码计算了一个 HMA，然后基于一个百分比 (5%) 乘以偏移参数 (`buy_offset_hma1`) 来创建一个偏移值。
	      *   **多头入场 (Long Entries):** 通常在 `close`（收盘价）*低于*某个偏移 MA 带时触发（例如 `dataframe['close'] < dataframe['hma_offset_buy1']`）。
	      *   **空头入场 (Short Entries):** 通常在 `close`（收盘价）*高于*某个偏移 MA 带时触发（例如 `dataframe['close'] > dataframe['hma_offset_buy3']`）。
	      *   **占位符 RSI/MFI:** MA 偏移条件会与 `rsi_1`, `rsi_12`, `rsi_13`, `rsi_4` 等条件结合使用。**这些就是你需要替换掉的无实际功能的占位符。**
	      *   代码中也包含了一些概念性的 RSI/MFI 入场逻辑，基于滚动窗口内的阈值和动量变化（例如，RSI 跌破某个值，前后周期的 RSI 差值大于某个值）。
	      *   定义了多个潜在的入场条件，并通过 OR 逻辑组合起来 (`reduce(lambda x, y: x | y, conditions)`)。任何一个条件满足都可能触发入场。
	      *   为方便分析，添加了描述性的入场标签 (`enter_tag`)。
	  6.  **出场逻辑 (`populate_exit_trend`)：**
	      *   使用 EMA 偏移量来定义出场条件。
	      *   **多头出场 (Exit Long):** 通常在 `close` 价格*高于*某个上轨 EMA (`sell_ema_1`) 或*低于*某个下轨 EMA (`sell_ema_2`) 时触发。
	      *   **空头出场 (Exit Short):** 通常在 `close` 价格*低于*某个下轨 EMA (`sell_ema_3`) 或*高于*某个上轨 EMA (`sell_ema_4`) 时触发。
	      *   多个出场条件也通过 OR 逻辑组合。
	  7.  **自定义出场 (`custom_exit`)：**
	      *   增加了一个基于时间的出场规则：如果一笔交易持有了特定数量的 K 线 (`sell_clear_old_trade`，默认 20 根，即 5 小时) 并且亏损不大（默认利润 >= 0%），则强制平仓。这可以防止交易在没有触达止盈或出场信号的情况下无限期持有。
	  8.  **杠杆 (`leverage`)：**
	      *   一个简单的函数，仅返回固定的杠杆值 (`self.lev`)。
	  
	  **如何理解和使用这份代码：**
	  
	  1.  **理解核心概念：** 明白策略是围绕“移动平均线偏移”这个核心思想构建的。
	  2.  **识别占位符：** 认识到所有使用未定义变量（如 `rsi_1`, `rsi_12` 等）的条件都是不完整的。
	  3.  **开发关键逻辑：** 你的主要任务是用 `populate_indicators` 函数中计算出的真实指标来替换那些占位符条件。例如，你需要决定用什么样的具体 RSI、MFI 或其他指标条件来确认一个 MA 偏移信号是有效的（比如，`(dataframe['rsi'] < 30)` 或 `(dataframe['fastk'] > 80)` 等）。
	  4.  **设置实际的风险管理：** **立即**将 `stoploss = -0.99` 修改为一个合理的数值（例如 `-0.05` 代表 5% 的止损）。根据你的风险承受能力和回测结果，仔细评估杠杆 (`lev`) 和止盈 (`minimal_roi`) 设置。
	  5.  **优化和回测：** 对你想要调整的参数启用优化 (`optimize = True`)。在你**开发完成**策略后，务必使用 Freqtrade 的回测和超参数优化工具进行大量的测试，然后再考虑投入任何真实资金。
	  
	  **总结来说：** 这份代码提供了一个围绕 MA 偏移策略的骨架。它包含了基本的结构和参数化设置，但**将最关键的确认逻辑（占位符部分）和安全保障（如合理的止损）留给了用户去正确地实现和配置**。
-